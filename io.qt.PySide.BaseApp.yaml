app-id: io.qt.PySide.BaseApp
branch: '6.2'
runtime: org.kde.Platform
runtime-version: '6.2'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm13
command: /usr/bin/bash
separate-locales: false
base: io.qt.qtwebengine.BaseApp
base-version: '6.2'
build-options:
  append-path: /usr/lib/sdk/llvm13/bin
  append-ld-library-path: /usr/lib/sdk/llvm12/lib
modules:
  - name: pyside
    buildsystem: cmake-ninja
    builddir: true
    # TODO: fix numpy detection
    build-options:
      cxxflags: -I/run/build/pyside/sources/shiboken6/libshiboken/signature
    config-opts:
      - -DBUILD_TESTS=OFF
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_SKIP_RPATH:BOOL=YES
    sources:
      - type: archive
        url: https://download.qt.io/official_releases/QtForPython/pyside6/PySide6-6.2.4-src/pyside-setup-opensource-src-6.2.4.tar.xz
        sha256: d9680ff298ee8b01a68de20911c60da04568a0918b3062d4c571ef170b4603ff
      - type: shell
        # different workarounds for shibkon ignoring /usr/include and /app/include
        commands:
          - cp -R /usr/include/Qt* sources/pyside6/PySide6/

          # doesn't work
         #- sed -i 's|\(--include-paths=.*\)|\1 --system-include-paths=/usr/include/:/usr/lib/x86_64-linux-gnu/include|' sources/pyside6/cmake/Macros/PySideModules.cmake

         #- sed -i 's|--include-paths=|--include-paths=/usr/include:|' sources/pyside6/cmake/Macros/PySideModules.cmake

         #- install -dm755 /app/include/Qt6
         #- cp -R /usr/include/Qt* /app/include/Qt6
         #

         #- install -dm755 /app/include/Qt6
         #- |
         #  for d in /usr/include/Qt*; do
         #    ln -s $d /app/include/Qt6/$(basename $d)
         #  done
         #- sed -i 's|--include-paths=|--include-paths=/app/include/Qt6:|' sources/pyside6/cmake/Macros/PySideModules.cmake

         #- install -dm755 sources/pyside6/PySide6/Qt6
         #- |
         #  for d in /usr/include/Qt*; do
         #    ln -s $d sources/pyside6/PySide6/Qt6/$(basename $d)
         #  done
    modules:
#     - python-numpy/python-numpy.json
      # needed as the cmake super project doesn't find the shiboken python module
      - name: shiboken
        buildsystem: cmake-ninja
        builddir: true
        subdir: sources/shiboken6
        config-opts:
          - -DBUILD_TESTS=OFF
        sources:
          - type: archive
            url: https://download.qt.io/official_releases/QtForPython/pyside6/PySide6-6.2.4-src/pyside-setup-opensource-src-6.2.4.tar.xz
            sha256: d9680ff298ee8b01a68de20911c60da04568a0918b3062d4c571ef170b4603ff
